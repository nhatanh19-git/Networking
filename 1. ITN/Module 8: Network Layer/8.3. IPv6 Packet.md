| **Title** | 8.3. IPv6 Packet |
|:---------:|:----------------:|
| **ID**    | CCNET039         |
| **Tag**   | CCNA, Cisco, IPv6, Packet, Header, Network Layer |

---

## 8.3.1. Limitations of IPv4

Trước khi tìm hiểu IPv6, cần hiểu rõ những **hạn chế của IPv4**, nguyên nhân khiến Internet phải chuyển đổi sang thế hệ địa chỉ mới.

Ba vấn đề lớn nhất của IPv4:

1. **Cạn kiệt địa chỉ (Address Depletion):**  
   IPv4 chỉ có khoảng **4tỷ địa chỉ**, trong khi số thiết bị Internet (IoT, smartphone, server, v.v.) tăng quá nhanh.  
   → Không đủ địa chỉ công cộng (public address) cho toàn cầu.

2. **Thiếu kết nối đầu-cuối (End-to-End Connectivity):**  
   IPv4 phải dùng **NAT (Network Address Translation)** để nhiều thiết bị dùng chung một địa chỉ công cộng.  
   NAT giúp tiết kiệm IP. Tuy nhiên, bởi vì địa chỉ IPv4 công cộng bị chia sẻ nên địa chỉ IPv4 trong mạng nội bộ bị ẩn, **phá vỡ kết nối trực tiếp**, ảnh hưởng đến dịch vụ như VoIP, P2P, hay VPN.

3. **Độ phức tạp mạng tăng (Increased Complexity):**  
   NAT khiến quá trình **định tuyến, bảo mật, và gỡ lỗi (troubleshooting)** trở nên phức tạp, làm giảm hiệu năng.

>  NAT chỉ là giải pháp tạm thời — IPv6 được thiết kế để loại bỏ hoàn toàn nhu cầu dùng NAT.

---

## 8.3.2. IPv6 Overview

Nhằm khắc phục hạn chế của IPv4, **IETF (Internet Engineering Task Force)** đã phát triển **IPv6** từ đầu thập niên 1990.  
IPv6 là **phiên bản nâng cấp toàn diện** của giao thức IP, giúp Internet mở rộng không giới hạn.

<p align="center">
  <img src="../../images/kì 1/module 8/8.3.2.jpg" width="450"/>
</p>

**Ưu điểm nổi bật của IPv6:**

-  **Không gian địa chỉ khổng lồ:**  
  IPv6 sử dụng địa chỉ phân cấp **128 bit** 
  → Đủ cho **mọi thiết bị trên Trái Đất** có địa chỉ riêng.

-  **Xử lý gói tin hiệu quả hơn:**  
  IPv6 header **ngắn gọn và cố định (40 bytes)**, giúp router xử lý nhanh hơn.

-  **Loại bỏ NAT:**  
  Nhờ lượng địa chỉ dồi dào, mỗi thiết bị có thể sở hữu **địa chỉ toàn cầu duy nhất**, khôi phục khả năng **end-to-end connectivity**.

> IPv4 = 32 bit ≈ 4,294,967,296 địa chỉ  
> IPv6 = 128 bit ≈ 340,282,366,920,938,463,463,374,607,431,768,211,456 (hoặc 340 undecillion) địa chỉ    
> (tương đương với **số hạt cát trên toàn Trái Đất** )

---

## 8.3.3. IPv4 Packet Header Fields in the IPv6 Packet Header

IPv6 không chỉ tăng độ dài địa chỉ, mà còn **tối ưu hóa cấu trúc gói tin** so với IPv4.

###  So sánh IPv4 và IPv6 Header

| Thành phần | IPv4 | IPv6 |
|-------------|------|------|
| **Độ dài header** | 20–60 bytes (thay đổi) | 40 bytes (cố định) |
| **Checksum** | Có | Loại bỏ |
| **Fragmentation** | Router có thể phân mảnh | Chỉ host nguồn phân mảnh |
| **Options** | Có (nhiều trường tùy chọn) | Tách ra thành **Extension Headers** |
| **Định danh địa chỉ** | 32 bit | 128 bit |

IPv6 loại bỏ nhiều trường không cần thiết như **Header Checksum, Identification, Flags, Fragment Offset**, giúp **router xử lý nhanh hơn** và **ít lỗi hơn**.

###  IPv4 Header
<p align="center">
  <img src="../../images/kì 1/module 8/8.3.3_1.jpg" width="450"/>
</p>

### IPv6 Header
<p align="center">
  <img src="../../images/kì 1/module 8/8.3.3_2.jpg" width="450"/>
</p>

> **Tóm lại:** IPv6 header đơn giản hơn, dễ phân tích và nâng cao hiệu suất định tuyến.

---

## 8.3.4. IPv6 Packet Header

IPv6 có **header cố định 40 byte**, gồm các trường sau:

<p align="center">
  <img src="../../images/kì 1/module 8/8.3.4.jpg" width="500"/>
</p>

| Trường | Kích thước | Mô tả |
|--------|-------------|--------|
| **Version** | 4 bit | Luôn là `0110`, xác định đây là gói IPv6. |
| **Traffic Class** | 8 bit | Xác định ưu tiên (tương đương trường ToS- Type of Service ở IPv4). |
| **Flow Label** | 20 bit | Định danh luồng dữ liệu để router xử lý thống nhất. |
| **Payload Length** | 16 bit | Độ dài phần dữ liệu (không tính header). |
| **Next Header** | 8 bit | Xác định giao thức tầng trên (TCP, UDP, ICMPv6...). |
| **Hop Limit** | 8 bit | Giống trường Time-to-Live của IPv4 – giảm 1 sau mỗi router. Khi về 0, gói tin bị loại bỏ và 1 **ICMPv6 Time Exceeded message**(tin nhắn quá hạn ICMPv6) được chuyển tiếp đến máy chủ gửi|
| **Source Address** | 128 bit | Địa chỉ IPv6 của thiết bị gửi. |
| **Destination Address** | 128 bit | Địa chỉ IPv6 của thiết bị nhận. |

 **Extension Headers (EH):**  
Các phần mở rộng tùy chọn, nằm giữa IPv6 header và payload.  
Dùng cho các chức năng như **bảo mật (IPSec), phân mảnh, hoặc di động**.

>  IPv6 **không cho phép router phân mảnh gói tin** — chỉ **host nguồn** mới được phép chia nhỏ gói.  -> không cần quan tâm đến **MTU (Maximum Transmission Unit)**
> Điều này giúp giảm tải cho router và tăng hiệu năng toàn mạng.

## 8.3.5. Video – Sample IPv6 Headers in Wireshark
[Click to play](https://www.youtube.com/watch?v=Q3HmdAmeMG4)


