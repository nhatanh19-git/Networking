
| **Title** | 8.5. Introduction to Routing |
|:---------:|:-----------------------------:|
| **ID**    | CCNET041                     |
| **Tag**   | CCNA, Cisco, Routing, IPv4, Static, Dynamic, OSPF, EIGRP |

---

# 8.5. Introduction to Routing

Ở các phần trước, ta tìm hiểu cách một **host** xử lý bảng định tuyến và quyết định gửi gói tin đi đâu.  
Tuy nhiên, trong môi trường mạng thực tế, việc truyền dữ liệu **giữa các mạng** không chỉ dựa vào host mà chủ yếu do **router** đảm nhiệm.

Router hoạt động ở **Layer 3 (Network Layer)** của mô hình OSI và có nhiệm vụ:

- Nhận gói tin đến từ một mạng.
- Kiểm tra địa chỉ IP đích.
- Tra cứu bảng định tuyến.
- Quyết định con đường tốt nhất để chuyển tiếp gói tin.

---

## 8.5.1. Router Packet Forwarding Decision

Khi một gói tin đến router, thiết bị sẽ:

1. **Gỡ bỏ (de-encapsulate)** header/trailer của lớp 2 (Ethernet, PPP…).
2. Kiểm tra **địa chỉ IP đích** trong header lớp 3.
3. Tìm **route phù hợp nhất** trong bảng định tuyến (longest prefix match).
4. Đóng gói lại gói tin với **header lớp 2 mới** và gửi tới **next-hop** hoặc **exit interface**.

Ví dụ tiến trình xử lý của Router R1:

<p align="center">
  <img src="../../images/kì 1/module 8/8.5.1.jpg" width="480"/>
</p>

| Bước | Hành động |
|------|-----------|
| 1 | Gói tin đến cổng G0/0/0 → router R1 bỏ (de-encapsulate) lớp Ethernet frame (layer 2)|
| 2 | Router kiểm tra IP đích và tìm route khớp nhất |
| 3 | Bảng định tuyến cho thấy phải gửi qua Router R2 |
| 4 | R1 đóng gói lại (encapsulate) frame mới và gửi tới R2 |

### Bảng định tuyến của Router R1:

| Route | Next Hop / Interface |
|-------|----------------------|
| 192.168.10.0 /24 | G0/0/0 |
| 209.165.200.224/30 | G0/0/1 |
| 10.1.1.0/24 | via R2 |
| Default Route (0.0.0.0/0) | via R2 |

> **Router luôn chọn route có độ dài prefix lớn nhất (longest match)** — đây là nguyên tắc rất quan trọng trong định tuyến.

---

## 8.5.2. IP Router Routing Table

Bảng định tuyến của router chứa thông tin tất cả các mạng mà router biết cách đến.  
Có **3 loại route chính**:

- **Directly-connected networks** - Mạng kết nối trực tiếp vào interface của router 
Mỗi interface của router được kết nối với 1 miền mạng khác nhau. Như hình, directly-connected networks trong bảng IPv4 routing của R1 là 192.168.10.0/24 và 209.165.200.224/30.
- **Remote networks** - Mạng không trực tiếp kết nối — học qua static hoặc dynamic routing 
Router học các mạng từ xa bằng cách được quản trị viên cấu hình hoặc là tự học bằng cách trao đổi thông tin tuyết đường bằng giao thức định tuyến động (dynamic). Trong hình , mạng từ xa trong bảng định tuyến (routing table) của R1 là 10.1.1.0/24. 
- **Default route** - Tuyến mặc định → dùng khi không có route cụ thể (0.0.0.0/0). Trong hình, 
bảng định tuyến rất có thể có 1 default route để chuyển tiếp tất cả gói tới R2.

<p align="center">
  <img src="../../images/kì 1/module 8/8.5.2.jpg" width="520"/>
</p>


### Cách router học các remote networks:

-  **Tĩnh (Static Route)** – cấu hình thủ công
-  **Động (Dynamic Routing Protocol)** – tự động chia sẻ thông tin định tuyến

> Router càng kết nối nhiều mạng → bảng định tuyến càng quan trọng để tránh gửi sai đường.

---

## 8.5.3. Static Routing

Static route là route được **cấu hình thủ công** bởi quản trị viên mạng.
<p align="center">
  <img src="../../images/kì 1/module 8/8.5.3.jpg" width="520"/>
</p>

Ví dụ cấu hình static trên R1:
```bash
R1(config)# ip route 10.1.1.0 255.255.255.0 209.165.200.226
```

Static routing phù hợp khi:

- Mạng **nhỏ**
- **Ít thay đổi topology**
- Không có nhiều đường dự phòng

### **Ưu điểm & nhược điểm**

| Ưu điểm | Nhược điểm |
|--------|------------|
| Đơn giản | Không tự động cập nhật khi mạng thay đổi |
| Tiết kiệm tài nguyên | Quản trị thủ công mất thời gian |
| Bảo mật hơn | Không phù hợp mạng lớn |

---

## 8.5.4. Dynamic Routing

Dynamic routing protocol giúp router:

- Tự động học remote networks
- Chọn đường tốt nhất
- Tự cập nhật khi mạng thay đổi

Một số giao thức routing phổ biến trong CCNA:

| Protocol | Loại | Ghi chú |
|----------|------|---------|
| **OSPF** | Link-State | Dùng nhiều trong doanh nghiệp |
| **EIGRP** | Advanced Distance Vector | Tối ưu cho Cisco |
| **RIP** | Distance Vector | Dễ học nhưng không hiệu quả |

### Lợi ích của Dynamic Routing

- Tự động cập nhật tuyến đường khi mạng thay đổi
- Giảm tải cấu hình thủ công
- Hỗ trợ mạng lớn, phân cấp

Ví dụ chia sẻ route giữa R1 và R2 bằng OSPF:
<p align="center">
  <img src="../../images/kì 1/module 8/8.5.4.jpg" width="520"/>
</p>

- R1 quảng bá `192.168.10.0/24`
- R2 quảng bá `10.1.1.0/24`

Nếu đường đi R1 ↔ R2 bị lỗi → dynamic routing tự động tìm đường mới.

---

## 8.5.5. Video – IPv4 Router Routing Tables

[Click to play](https://www.youtube.com/watch?v=f2bns63mJYA)

---

## 8.5.6. Introduction to an IPv4 Routing Table

Router sử dụng lệnh sau để xem bảng định tuyến:
```bash
show ip route
```
Ví dụ xuất bảng định tuyến trên Router R1:
```bash
Gateway of last resort is 209.165.200.226 to network 0.0.0.0  
S* 0.0.0.0/0 [1/0] via 209.165.200.226, GigabitEthernet0/0/1  
O 10.1.1.0 [110/2] via 209.165.200.226, 00:02:45, GigabitEthernet0/0/1  
C 192.168.10.0/24 is directly connected, GigabitEthernet0/0/0  
L 192.168.10.1/32 is directly connected, GigabitEthernet0/0/0  
C 209.165.200.224/30 is directly connected, GigabitEthernet0/0/1  
L 209.165.200.225/32 is directly connected, GigabitEthernet0/0/1
```

### Ý nghĩa các ký tự trong routing table:

| Code | Ý nghĩa |
|------|--------|
| **L** | Local interface IP |
| **C** | Connected network |
| **S** | Static route |
| **O** | OSPF learned route |
| **D** | EIGRP learned route |





