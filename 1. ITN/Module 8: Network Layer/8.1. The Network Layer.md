
| **Title** | 8.1. The Network Layer |
|:---------:|:----------------------:|
| **ID**    | CCNET037               |
| **Tag**   | CCNA, Cisco, IPv4, IPv6, Network Layer, Encapsulation, MTU |

---

## 8.1.1. The Network Layer

Network layer (Layer 3 OSI) cho phép các thiết bị đầu cuối trao đổi dữ liệu qua nhiều mạng khác nhau. Các giao thức chính:

- **IPv4, IPv6** – giao thức truyền thông lớp mạng.  
- **OSPF (Open Shortest Path First)** – giao thức định tuyến.  
- **ICMP (Internet Control Message Protocol)** – giao thức nhắn tin, dùng để báo lỗi hoặc kiểm tra kết nối.

<p align="center">
  <img src="../../images/kì 1/module 8/8.1.1_1.jpg" width="400"/>
</p>

Network layer thực hiện 4 chức năng cốt lõi:

1. **Addressing (Địa chỉ hóa):** Mỗi thiết bị có một địa chỉ IP duy nhất.  
2. **Encapsulation (Đóng gói):** Gói dữ liệu từ Layer 4 được đóng gói thêm trường IP header (nguồn, đích).  
3. **Routing (Định tuyến):** Router chọn đường đi tốt nhất và chuyển gói qua  các trạm là các router ( mỗi router này gọi là 1 **hop**.  
4. **De-encapsulation (Bỏ gói):** Thiết bị đích kiểm tra địa chỉ IP, bỏ header và chuyển dữ liệu lên Layer 

> **Điểm khác biệt với Layer 4:** Layer 3 chỉ quan tâm đến việc đưa gói tin đến đúng đích, không quan tâm nội dung bên trong (TCP/UDP xử lý phần đó).

---

## 8.1.2. IP Encapsulation

IP sẽ **bọc gói tin của Transport Layer** (TCP segment hoặc UDP datagram) bằng cách thêm **IP header**, tạo thành **IP packet**.

<p align="center">
  <img src="../../images/kì 1/module 8/8.1.2.jpg" width="400"/>
</p>

- **IP header** giữ nguyên từ nguồn đến đích (trừ khi bị NAT thay đổi).
- **Routers & Layer 3 switches** đọc IP header để định tuyến.
- **Payload (data)** bên trong không bị thay đổi trong suốt quá trình truyền.

Điều này giúp các tầng trên phát triển độc lập (transport layer không cần biết hạ tầng mạng là gì, miễn có IP để vận chuyển).

---

## 8.1.3. Characteristics of IP

IP được thiết kế tối giản, chỉ tập trung vào việc giao gói tin từ nguồn đến đích.

**Đặc điểm chính:**

- **Connectionless:** Không cần tạo kết nối trước khi gửi dữ liệu.  
- **Best Effort:** Không đảm bảo gói tin đến đích (không xác nhận, không retransmit).  
- **Media Independent:** Hoạt động trên mọi loại môi trường (cáp đồng, quang, wireless).

---

## 8.1.4. Connectionless

IP không thiết lập kết nối trước. Hoạt động giống như việc bạn gửi thư mà không gọi điện trước cho người nhận.  

<p align="center">
  <img src="../../images/kì 1/module 8/8.1.4_1.jpg" width="400"/>
</p>

- Gói tin được gửi ngay khi có dữ liệu.  
- Không có gói "bắt tay" như ở TCP.  
- Các gói đi độc lập, có thể đến không theo thứ tự.

<p align="center">
  <img src="../../images/kì 1/module 8/8.1.4_2.jpg" width="400"/>
</p>

---

## 8.1.5. Best Effort

IP chỉ cố gắng chuyển gói đến đích nhưng **không theo dõi quá trình**.  
- Không biết đích có online hay không.  
- Không biết gói có đến nơi hay bị mất.  
- Không có cơ chế tự động gửi lại nếu bị lỗi.

<p align="center">
  <img src="../../images/kì 1/module 8/8.1.5.jpg" width="400"/>
</p>

> **Đảm bảo độ tin cậy** (acknowledgment, retransmission) do các giao thức khác đảm nhận, ví dụ: **TCP ở Layer 4**.

---

## 8.1.6. Media Independent

IP hoạt động độc lập với loại đường truyền. Gói IP có thể truyền:

- Dưới dạng tín hiệu điện trên cáp đồng.  
- Dưới dạng ánh sáng trên cáp quang.  
- Dưới dạng sóng vô tuyến trên mạng không dây.

Tuy nhiên, cần quan tâm đến **MTU (Maximum Transmission Unit)** – kích thước gói tối đa mà môi trường truyền tải cho phép.

- Nếu gói lớn hơn MTU → router phải **phân mảnh (fragmentation)** (chỉ với IPv4).  
- IPv6 **không cho phép router phân mảnh**, nguồn phải gửi gói phù hợp ngay từ đầu.  

<p align="center">
  <img src="../../images/kì 1/module 8/8.1.6.jpg" width="400"/>
</p>

>**Fragmentation gây trễ**, nên tốt nhất là điều chỉnh MTU để tránh phải phân mảnh.


