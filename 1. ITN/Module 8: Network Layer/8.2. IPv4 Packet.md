
| **Title** | 8.2. IPv4 Packet |
|:---------:|:----------------|
| **ID**    | CCNET038        |
| **Tag**   | CCNA, Cisco, IPv4, Packet, Header, Layer 3, Network Layer |

---

## 8.2.1. IPv4 Packet Header

**IPv4 (Internet Protocol version 4)** là giao thức lớp mạng phổ biến nhất hiện nay.  
Mục tiêu chính của gói tin IPv4 là **đảm bảo gói tin được gửi đến đúng thiết bị đích** trong suốt quá trình truyền qua nhiều mạng trung gian.

Mỗi gói tin IPv4 bao gồm hai phần:
- **Header:** chứa thông tin điều khiển (địa chỉ, loại dịch vụ, TTL, v.v.).
- **Data:** chứa dữ liệu của tầng trên (Transport Layer – TCP hoặc UDP).

Router và thiết bị Layer 3 đọc các trường trong **IPv4 header** để định tuyến gói tin đến đúng nơi cần đến.

---

## 8.2.2. IPv4 Packet Header Fields

Một **IPv4 header** chứa nhiều trường, mỗi trường mang ý nghĩa riêng để giúp quá trình định tuyến và kiểm soát hoạt động chính xác.

###  Các trường quan trọng trong IPv4 Header:

<p align="center">
  <img src="../../images/kì 1/module 8/8.2.2.jpg" width="500"/>
</p>


| **Trường** | **Ý nghĩa chính** |
|:------------|:-----------------|
| **Version (4 bit)** | Luôn có giá trị `0100` (chỉ ra đây là gói tin IPv4). |
| **Differentiated Services (DS)** | 8 bit, dùng để xác định mức độ ưu tiên (QoS – Quality of Service). Gồm DSCP(differentiated services code point - 6 bit) bit xác nhận mã các dịch vụ khác và ECN(explicit congestion notification - 2 bit) bit thông báo tắc nghẽn. |
| **Time To Live (TTL)** | 8 bit, quy định “tuổi thọ” của gói tin. Mỗi khi qua 1 router, TTL giảm 1. Nếu TTL = 0, gói bị hủy, router gửi Internet Control Message Protocol (ICMP) tới IP nguồn, tránh vòng lặp định tuyến. |
| **Protocol** | 8 bit, cho biết tầng 4 sử dụng giao thức nào (TCP = 6, UDP = 17, ICMP = 1). |
| **Header Checksum** | Dùng để kiểm tra lỗi trong phần header. Mỗi router khi giảm TTL sẽ phải tính lại giá trị này. |
| **Source IPv4 Address** | Địa chỉ IP của thiết bị gửi (32-bit, luôn là unicast). |
| **Destination IPv4 Address** | Địa chỉ IP của thiết bị nhận (có thể unicast, multicast hoặc broadcast). |

---

## 8.2.3. Video – Sample IPv4 Headers in Wireshark

[Click to play](https://www.youtube.com/watch?v=LQNwGM_TCRU)

---

###  Các trường kỹ thuật khác:

| **Trường** | **Chức năng** |
|:------------|:--------------|
| **IHL (Internet Header Length)** | Xác định độ dài phần header. |
| **Total Length** | Tổng kích thước gói tin (header + data). |
| **Identification, Flags, Fragment Offset** | Dùng cho **fragmentation (phân mảnh)** – chia nhỏ gói khi vượt quá MTU của đường truyền. |
| **Options & Padding** | Hiếm khi sử dụng, dùng cho mục đích đặc biệt (thí nghiệm, test). |


>  Ghi nhớ: 
>- **Source và Destination IP** là hai trường quan trọng nhất, không thay đổi trong quá trình truyền (trừ khi bị NAT).  
>- Khi gói vượt quá kích thước MTU, router **phải phân mảnh** (IPv4 hỗ trợ, IPv6 thì không).  
>- **Header Checksum** giúp router phát hiện lỗi, đảm bảo gói không bị hỏng khi di chuyển giữa các mạng.


