
| **Title** | 9.1. MAC and IP |
|:---------:|:-----------------------------:|
| **ID**    | CCNET042 |
| **Tag**   | CCNA, Cisco, MAC Address, IP Address, ARP, ND, Ethernet |

---

# 9.1. MAC and IP

Trong mạng máy tính, mỗi thiết bị mạng có **hai loại địa chỉ quan trọng**:

| Loại địa chỉ | Vai trò |
|--------------|---------|
| **MAC Address (Layer 2)** | Dùng để giao tiếp **giữa các thiết bị trong cùng mạng LAN** |
| **IP Address (Layer 3)** | Dùng để định danh thiết bị trong mạng và **định tuyến gói tin giữa các mạng khác nhau** |

Địa chỉ IP giúp xác định **điểm đến logic**, còn MAC address giúp gói tin **thực sự tới đúng card mạng** của thiết bị trong LAN.

Tuy nhiên, nếu host chỉ biết **địa chỉ IP của đích** thì làm sao tìm ra MAC address của thiết bị đó?

Khi đó, ta cần cơ chế **Address Resolution**.

---

## 9.1.1. Destination on Same Network

Khi **IP đích nằm trên cùng mạng LAN**, host cần tìm MAC address tương ứng để đóng khung Ethernet Frame trước khi gửi.

Ví dụ:  
PC1 muốn gửi dữ liệu đến PC2 và **cả hai cùng subnet 192.168.10.0/24.**

<p align="center">
  <img src="../../images/kì 1/module 9/9.1.1.jpg" width="520"/>
</p>

Thông tin gói tin được đóng như sau:

### **Layer 3 (IP Packet)**

| Trường thông tin | Giá trị |
|------------------|---------|
| Source IP | `192.168.10.10` (PC1 IPv4) |
| Destination IP | `192.168.10.11` (PC2 IPv4) |

### **Layer 2 (Ethernet Frame)**

| Trường thông tin | Giá trị |
|------------------|---------|
| Source MAC | `aa-aa-aa` (PC1 NIC) |
| Destination MAC | `55-55-55` (PC2 NIC) |

>  Khi thiết bị đích cùng mạng → **Frame được gửi trực tiếp** giữa NIC và NIC thông qua switch.

Nếu PC1 chưa biết MAC của PC2 → nó sẽ dùng **ARP (IPv4)** hoặc **Neighbor Discovery (IPv6)** để tìm.

---

## 9.1.2. Destination on Remote Network

Nếu địa chỉ IP đích **không nằm cùng mạng**, host **không gửi trực tiếp cho PC đích**, mà gửi cho **Default Gateway (router).**

Ví dụ:  
PC1 muốn gửi gói tin đến PC2 nhưng PC2 nằm trên **mạng khác**.

<p align="center">
  <img src="../../images/kì 1/module 9/9.1.2_1.jpg" width="520"/>
</p>

### **Layer 3 (IP Packet)** _(không thay đổi trên đường đi)_

| Trường | Giá trị |
|--------|---------|
| Source IP | `192.168.10.10` (PC1) |
| Destination IP | `10.1.1.10` (PC2 - Remote network) |

### **Layer 2 (Ethernet Frame)** _(thay đổi ở mỗi hop)_

Ban đầu từ PC1 → Router R1:

| Trường | Giá trị |
|--------|---------|
| Source MAC | `aa-aa-aa` (MAC của PC1) |
| Destination MAC | `bb-bb-bb` (MAC của Router R1 interface G0/0/0) |


<p align="center">
  <img src="../../images/kì 1/module 9/9.1.2_2.jpg" width="520"/>
</p>

Khi Router R1 chuyển tiếp đến router R2, nó sẽ **đóng frame mới**:

| Trường | Giá trị |
|--------|---------|
| Source MAC | `cc-cc-cc` (MAC của R1 interface G0/0/1)|
| Destination MAC | `dd-dd-dd` (MAC của R2 interface G0/0/1) |

<p align="center">
  <img src="../../images/kì 1/module 9/9.1.2_2.jpg" width="520"/>
</p>

Khi Router R2 chuyển tiếp đến router PC2 (đích) , nó sẽ tiếp tục **đóng frame mới**:

| Trường | Giá trị |
|--------|---------|
| Source MAC | `ee-ee-ee` (MAC của R2 interface G0/0/0)|
| Destination MAC | `55-55-55` (MAC của PC2) |

>  **IP không đổi khi đi qua các router, nhưng MAC thay đổi tại mỗi hop!**

---

### Cơ chế nào gán MAC tương ứng với IP?

| Giao thức | Dùng cho | Chức năng |
|-----------|----------|-----------|
| **ARP (Address Resolution Protocol)** | IPv4 | Tìm MAC address của thiết bị theo IP |
| **ICMPv6 Neighbor Discovery (ND)** | IPv6 | Tương tự ARP nhưng mạnh hơn, bảo mật hơn |

>  **ARP = IPv4 resolution**  
>  **ND = IPv6 resolution**

