
| **Title** | 7.4. Switch Forwarding Methods and Settings |
|:---------:|:-------------------------------------------:|
| **ID**    | CCNET036                                    |
| **Tag**   | CCNA, Cisco, Switching, Cut-Through, Store-and-Forward, Duplex, Auto-MDIX |

---

## 7.4.1. Frame Forwarding Methods on Cisco Switches

Cisco switch sử dụng **MAC address table** để xác định cổng chuyển tiếp, nhưng có hai phương pháp chuyển tiếp chính:

- **Store-and-Forward Switching**  
  - Nhận toàn bộ frame, tính **CRC** (Cyclic Redundancy Check) để kiểm tra lỗi.  
  - Nếu frame hợp lệ → tra MAC table → gửi ra cổng đích.  
  - Ưu điểm: loại bỏ frame lỗi, giảm băng thông bị lãng phí, hỗ trợ **QoS** (ưu tiên VoIP (Voice Over IP - công nghệ truyền âm thanh thông qua IP), video).
    
<p align="center">
  <img src="../../images/kì 1/module 7/7.4.1.jpg" width="400"/>
</p>

- **Cut-Through Switching**  
  - Đọc đủ **địa chỉ đích (6 byte đầu)** là bắt đầu chuyển tiếp.  
  - Giảm **độ trễ** nhưng không kiểm tra lỗi trước khi gửi.

> **So sánh:** Store-and-forward ưu tiên tính chính xác, cut-through ưu tiên tốc độ.

---

## 7.4.2. Cut-Through Switching

Cut-through hoạt động ngay khi nhận được địa chỉ MAC đích, không đợi cả frame. Cut-through có hai biến thể:

<p align="center">
  <img src="../../images/kì 1/module 7/7.4.2.jpg" width="400"/>
</p>

- **Fast-Forward Switching:**  
  - Gửi ngay khi đọc xong địa chỉ đích → độ trễ thấp nhất.  
  - Có thể chuyển tiếp cả frame bị lỗi (hiếm gặp, NIC đích sẽ loại bỏ).

- **Fragment-Free Switching:**  
  - Lưu 64 byte đầu trước khi gửi (vì hầu hết lỗi xảy ra trong 64 byte đầu, đảm bảo không có xung đọt trước khi forward).  
  - Cân bằng giữa tốc độ (cut-through) và độ tin cậy (store-and-forward).

Một số switch tự động chuyển giữa cut-through ↔ store-and-forward dựa trên tỉ lệ lỗi.

---

## 7.4.3. Memory Buffering on Switches

Switch dùng **Memory buffering** (bộ nhớ đệm) để lưu frame khi cổng đích đang bận vì tắc nghẽn. Hai phương pháp:

- **Port-based Memory**  
  - Mỗi cổng có hàng đợi riêng.  
  - Nếu một frame bị chặn, tất cả frame phía sau phải đợi, dù có thể gửi sang cổng khác.
  - Điều này tạo ra trường hợp 1 frame tắc nghẽn kéo theo sự tắc nghẽn của cả cổng.

- **Shared Memory**  
  - Tất cả frame được lưu trong bộ nhớ chung. Điều này cho phép nhận được một gói trên một cổng và sau đó được truyền trên một cổng khác, mà không chuyển nó sang một hàng đợi khác.
  - Cổng đích sẽ được cấp phát bộ nhớ động khi sẵn sàng gửi → giảm tỉ lệ mất gói.  
  - Tối ưu khi tốc độ giữa cổng khác nhau (VD: server 10 Gbps ↔ PC 1 Gbps).

---

## 7.4.4. Duplex and Speed Settings

Hai cấu hình cơ bản của cổng switch: **tốc độ (speed)** và **duplex**
Trong đó có 2 loại cấu hình duplex được sử dụng để giao tiếp trong mạng Ethernet:

- **Full-duplex:** Gửi và nhận đồng thời → không có va chạm.  
- **Half-duplex:** Chỉ gửi hoặc nhận một lúc → có thể xảy ra collision.

### Autonegotiation  (tự động hóa)
Đây là chức năng trên hầu hết Ethernet Switch và NIC cho phép tự thỏa thuận tốc độ và duplex. Nếu hỗ trợ full-duplex → chọn full-duplex + tốc độ cao nhất của 2 thiết bị.  
<p align="center">
  <img src="../../images/kì 1/module 7/7.4.4_1.jpg" width="400"/>
</p>

>**Duplex mismatch** (một đầu full, một đầu half) → hiệu suất kém, nhiều collision.
<p align="center">
  <img src="../../images/kì 1/module 7/7.4.4_2.jpg" width="400"/>
</p>

---

## 7.4.5. Auto-MDIX

Kết  nối giữa các thiết bị cần sử dụng 1 cáp thẳng (straight-through cable) hoặc cáp chéo (crossover cable) . Cách chọn phụ thuộc vào loại của các thiết bị kết nối:

- **Straight-through:** nối thiết bị khác loại (switch ↔ PC, switch ↔ router).  
- **Crossover:** nối thiết bị cùng loại (switch ↔ switch, PC ↔ PC).

<p align="center">
  <img src="../../images/kì 1/module 7/7.4.5.jpg" width="400"/>
</p>

Giờ đây, hầu hết switch hỗ trợ **Auto-MDIX**:
- Tự phát hiện loại cáp và đảo dây nội bộ nếu cần.  

 Auto-MDIX thường bật mặc định trên switch Cisco IOS Release 12.2(18)SE+ hoặc các phiên bản sau.   
Nếu tắt, có thể bật lại với lệnh:
```bash
Switch(config-if)# mdix auto
```
>Do vậy nên lựa chọn đúng cáp mà không phụ thuộc vào auto-MDIX
