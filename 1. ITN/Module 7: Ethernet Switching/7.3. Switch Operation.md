
| **Title** | 7.3. Switch Operation |
|:---------:|:----------------------:|
| **ID**    | CCNET035               |
| **Tag**   | CCNA, Cisco, Switching, MAC, Ethernet |

---

## 7.3.1. Switch Fundamentals

Switch là thiết bị lớp 2 dùng **MAC Address** để quyết định chuyển tiếp khung (frame).  
- Không quan tâm đến dữ liệu lớp trên (IPv4, ARP, IPv6 ND...).  
- Khác với **hub** (phát lại tín hiệu ra tất cả cổng), switch chỉ gửi đến cổng đích cần thiết.  

Switch duy trì **MAC Address Table** (hay còn gọi là **content addressable memory (CAM) table**) để biết mỗi thiết bị gắn với cổng nào.  
- Khi mới khởi động, bảng này rỗng.  
- Switch sẽ học dần địa chỉ MAC khi nhận frame từ các thiết bị.

<p align="center">
  <img src="../../images/kì 1/module 7/7.3.1.jpg" width="400"/>
</p>

---

## 7.3.2. Switch Learning and Forwarding

Quy trình hoạt động chính:  
1. **Learning (Học)**  
   - Khi nhận frame, switch đọc **Source MAC** và cổng vào.  
   - Nếu MAC chưa có trong bảng → thêm mới.  
   - Nếu đã có → reset timer (mặc định 5 phút).  
   - Nếu cùng MAC nhưng khác cổng → cập nhật lại cổng mới nhất.  

<p align="center">
  <img src="../../images/kì 1/module 7/7.3.2_1.jpg" width="400"/>
</p>

   Ví dụ: PC-A gửi frame đến PC-D → switch ghi lại địa chỉ MAC của PC-A và gán với cổng kết nối.

2. **Forwarding (Chuyển tiếp)**  
   - Switch tìm trong bảng xem **Destination MAC** có tồn tại không.  
   - Nếu có → gửi frame ra đúng cổng tương ứng.  
   - Nếu không có → switch **flood** frame ra tất cả cổng (trừ cổng nhận).

<p align="center">
  <img src="../../images/kì 1/module 7/7.3.2_2.jpg" width="400"/>
</p>

 Ví dụ: PC-A gửi frame đến PC-D nhưng MAC của PC-D không có trong MAC Address Table → switch **flood** frame ra tất cả các cồng trừ cổng nhận là cổng 1.

---

## 7.3.3. Filtering Frames

Khi bảng MAC đã được điền đủ thông tin, switch có thể **lọc và gửi chính xác**:  

- **PC-D trả lời PC-A:**  
  - Sau khi flood, PC-D đối chiếu địa chỉ MAC đích đúng với MAC của mình, và gửi 1 frame lại trả lời PC-A.  
  - Switch thấy địa chỉ MAC của PC-D trong frame tới từ cổng 4.
  - Switch sau đó đưa địa chỉ MAC của PC-D vào MAC Address Table liên kết với cổng 4.  
<p align="center">
  <img src="../../images/kì 1/module 7/7.3.3_1.jpg" width="400"/>
</p>

- **Switch chuyển tiếp tới PC-A:**  
  - Khi chuyển tiếp gói tin tới PC-A, switch nhận thấy địa chỉ MAC của PC-A đã có trong bảng MAC Address Table tới từ cổng 1.  
  - Switch **filter** (lọc) frame và gửi về nó đến đúng cổng 1.
<p align="center">
  <img src="../../images/kì 1/module 7/7.3.3_2.jpg" width="400"/>
</p>

- **PC-A tiếp tục gửi tới PC-D:**  
  - Switch nhận frame khác PC-A và đặt lại bộ đếm của MAC address ở cổng 1.
  - Switch thấy địa chỉ MAC của PC-D trong frame tới từ cổng 4.
  - Switch lọc frame và chuyển tiếp gói tin tới cổng 4.  
<p align="center">
  <img src="../../images/kì 1/module 7/7.3.3_3.jpg" width="400"/>
</p>

> Nhờ cơ chế **learning + forwarding + filtering**, switch giảm thiểu lãng phí băng thông và tránh tắc nghẽn như hub.
